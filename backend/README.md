# 台北市食品安全資料處理工具集

這個專案整合了多個台北市政府衛生局食品安全相關資料的處理工具，可以自動下載、解析並輸出結構化的資料。

## 專案概覽

本專案包含三個主要模組：

1. **餐飲稽查** - 即時抓取餐飲業者稽查資料
2. **夜市食安微笑標章** - 處理夜市攤商評核 PDF 資料
3. **餐飲衛生管理分級評核** - 下載並處理餐廳衛生評級資料

## 功能特色

- 🌐 自動從多個資料源下載最新資料
- 📄 支援 PDF、CSV、網頁爬蟲等多種資料格式
- 🧹 智能清理和解析資料
- 📊 輸出 JSON 和 CSV 兩種格式
- 💾 原子寫入操作，確保資料安全
- 🔄 支援多年度資料處理
- ⚡ 平行處理提升效能

## 安裝

### 1. 安裝 Python 依賴

```bash
pip install -r requirements.txt
```

## 使用方法

### 1️⃣ 餐飲稽查資料爬蟲

即時抓取台北市餐飲業者稽查資料，包含業者名稱、地址、電話、登錄字號、GPS 座標等。

```bash
cd 餐飲稽查
python3 scrape_final.py
```

**輸出檔案：**
- `food_data.json` - JSON 格式
- `food_data.csv` - CSV 格式

**資料來源：** [臺北市政府衛生局食藥粧網路地圖](https://imap.health.gov.tw/)

詳細說明請參考：[餐飲稽查/README.md](餐飲稽查/README.md)

---

### 2️⃣ 夜市食安微笑標章

處理台北市夜市食安微笑標章 PDF 資料，提取攤商評核結果。

```bash
cd 夜市食安微笑標章獲頒名單
python parse_nightmarket_data.py
```

**輸出檔案：**
- `夜市食安微笑標章獲頒名單.json` - JSON 格式
- `夜市食安微笑標章獲頒名單.csv` - CSV 格式

**已處理年度：**
- ✅ 112 年度：4 個夜市，228 個攤位
- ✅ 113 年度：6 個夜市，237 個攤位

**資料來源：** [台北市政府衛生局](https://health.gov.taipei/News.aspx?n=76B61C8754E47803&sms=84804F52CD70DFE4)

詳細說明請參考：[夜市食安微笑標章獲頒名單/README.md](夜市食安微笑標章獲頒名單/README.md)

---

### 3️⃣ 餐飲衛生管理分級評核

自動下載並處理餐飲業者衛生管理分級評核資料。

```bash
cd 餐飲衛生管理分級評核業者名單
python fetch_restaurant_hygiene_ratings.py
```

**輸出檔案：**
- `餐飲衛生管理分級評核業者名單.json` - JSON 格式（登錄字號 → 評核結果）

**統計資訊（113 年度）：**
- 總業者數：1,575 家
- 優級：1,554 家（98.7%）
- 良級：21 家（1.3%）

**資料來源：** [台北市資料大平台](https://data.taipei)

詳細說明請參考：[餐飲衛生管理分級評核業者名單/README.md](餐飲衛生管理分級評核業者名單/README.md)

## 資料格式範例

### 餐飲稽查資料
```json
{
  "名稱": "洛碁大飯店南港館",
  "地址": "臺北市南港區忠孝東路7段528號8樓",
  "電話": "02-27893009",
  "登錄字號": "A-151191002-00002-9",
  "狀態": "合格",
  "日期": "2025.11.06",
  "經度": 121.6113669,
  "緯度": 25.05243
}
```

### 夜市食安微笑標章
```json
{
  "年度": "112年度",
  "編號": "1",
  "夜市名稱": "南機場夜市",
  "攤位名稱": "曉迪筒仔米糕",
  "食品業者登錄字號": "A-200049553-00000-5",
  "評核結果": "金質獎"
}
```

### 餐飲衛生管理分級評核
```json
{
  "A-153353122-00747-0": "優",
  "A-116098275-00015-2": "優",
  "A-101494522-00001-6": "良"
}
```

## 技術特點

- **原子寫入**：使用臨時文件 + 重命名，確保資料完整性
- **智能解析**：自動處理跨頁資料、合併換行、清理格式
- **平行處理**：使用多執行緒加速網頁爬蟲
- **錯誤處理**：完善的異常處理和重試機制
- **年度識別**：自動從檔案名稱或內容提取年度

## 專案結構

```
Hackathon/
├── requirements.txt                                    # Python 依賴套件
├── README.md                                           # 專案說明文件
├── setup.sh                                            # 快速安裝腳本
│
├── 餐飲稽查/
│   ├── README.md                                       # 餐飲稽查說明
│   ├── scrape_final.py                                 # 餐飲稽查爬蟲主程式
│   └── 狀態代碼說明.md                                 # API 狀態代碼說明
│
├── 夜市食安微笑標章獲頒名單/
│   ├── README.md                                       # 夜市資料說明
│   ├── parse_nightmarket_data.py                      # PDF 解析主程式
│   ├── 112年度夜市食安微笑標章獲頒名單.pdf
│   └── 113年度夜市食安微笑標章獲頒名單.pdf
│
└── 餐飲衛生管理分級評核業者名單/
    ├── README.md                                       # 評核資料說明
    └── fetch_restaurant_hygiene_ratings.py            # 評核資料處理主程式
```

## 系統需求

- Python 3.6 或更高版本
- 依賴套件詳見 [requirements.txt](requirements.txt)

## 資料來源

本專案資料來源均為台北市政府公開資料：

1. **餐飲稽查** - [臺北市政府衛生局食藥粧網路地圖](https://imap.health.gov.tw/)
2. **夜市食安微笑標章** - [台北市政府衛生局](https://health.gov.taipei/News.aspx?n=76B61C8754E47803&sms=84804F52CD70DFE4)
3. **餐飲衛生管理分級評核** - [台北市資料大平台](https://data.taipei)

## 注意事項

- 所有程式均包含錯誤處理機制
- 網頁爬蟲會遵守合理的請求頻率，避免對伺服器造成負擔
- 部分資料可能因來源格式問題而需要額外處理
- 輸出的資料僅供參考，正式用途請以官方網站為準

## 授權

本專案僅供學習和研究使用。所有資料版權屬於台北市政府相關單位。

## 作者

Ryan

## 更新日期

2025-11-08
